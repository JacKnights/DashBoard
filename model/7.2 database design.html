<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>系分大作业数据库相关</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
<style type="text/css">

#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}</style>
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="ruzw" id="系分大作业数据库相关">系分大作业数据库相关</h1><p data-anchor-id="4y2q"><code>系认同分析与设计</code></p><hr><ul data-anchor-id="pz9m">
<li>7.2 database design <br>
<ul><li>7.2.1 用户及权限系统数据库设计</li>
<li>7.2.2 点餐系统数据库设计</li></ul></li>
</ul><hr><div class="md-section-divider"></div><h2 data-anchor-id="uek0" id="721-用户及权限系统数据库设计">7.2.1 用户及权限系统数据库设计</h2><p data-anchor-id="kn4k">创建应用账户ooad，密码ooad</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="8cbb"><ol class="linenums"><li class="L0"><code class="language-mysql"><span class="pln">create user </span><span class="str">'ooad'</span><span class="pun">@</span><span class="str">'localhost'</span><span class="pln"> identified </span><span class="kwd">by</span><span class="pln"> </span><span class="str">'ooad'</span><span class="pun">;</span></code></li></ol></pre><p data-anchor-id="kyjk">创建应用数据库restaurant</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="pbch"><ol class="linenums"><li class="L0"><code class="language-mysql"><span class="pln">create database restaurant</span><span class="pun">;</span></code></li></ol></pre><p data-anchor-id="zxbc">为应用账号ooad设置对数据库restaurant的所有权限</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="vg3u"><ol class="linenums"><li class="L0"><code class="language-mysql"><span class="pln">grant all on restaurant</span><span class="pun">.*</span><span class="pln"> to </span><span class="str">'ooad'</span><span class="pun">@</span><span class="str">'localhost'</span><span class="pun">;</span></code></li></ol></pre><hr><div class="md-section-divider"></div><h2 data-anchor-id="8qnm" id="722-点餐系统数据库设计">7.2.2 点餐系统数据库设计</h2><p data-anchor-id="nzc7">参考的数据库建表图表 <br>
<img src="http://static.zybuluo.com/gzm1997/jkxxl2pljvr1axm3ztu94de9/image_1cdcvj1al1qv5hrr16dv1919c2o1m.png" alt="image_1cdcvj1al1qv5hrr16dv1919c2o1m.png-32.1kB"></p><hr><div class="md-section-divider"></div><h2 data-anchor-id="ge4y" id="数据库表">数据库表</h2><blockquote data-anchor-id="7raw" class="white-blockquote">
  <p>数据库初始化使用ORM sqlalchemy，一共4个表</p>
</blockquote><ul data-anchor-id="biyo">
<li>tag标签</li>
<li>food菜</li>
<li>comment评论</li>
<li>reservation订单</li>
</ul><p data-anchor-id="2d7s">创建一个名为model的包来创建数据结构和初始化数据库，包结构为</p><ul data-anchor-id="lsdf">
<li>model <br>
<ul><li>__init__.py</li>
<li>base.py</li>
<li>tag.py</li>
<li>food.py</li>
<li>comment.py</li>
<li>reservation.py</li>
<li>db_setting.py</li>
<li>init_db.py</li></ul></li>
</ul><p data-anchor-id="a0r5">model包测试文件test_model.py</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="k70c"><ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">from</span><span class="pln"> model </span><span class="kwd">import</span><span class="pln"> init_db</span></code></li><li class="L1"><code class="language-python"><span class="kwd">if</span><span class="pln"> __name__ </span><span class="pun">==</span><span class="pln"> </span><span class="str">"__main__"</span><span class="pun">:</span></code></li><li class="L2"><code class="language-python"><span class="pln">    init_db</span><span class="pun">.</span><span class="pln">init_database</span><span class="pun">()</span></code></li></ol></pre><p data-anchor-id="w97z">数据库初始化成功</p><div class="md-section-divider"></div><h2 data-anchor-id="o1hv" id="title"><img src="http://static.zybuluo.com/gzm1997/q3zwvfp5w9ybxknx7773hm49/image_1cdcuqh4iku11qts4201f2q1lch19.png" alt="image_1cdcuqh4iku11qts4201f2q1lch19.png-67.8kB"></h2><p data-anchor-id="odyh">tag标签</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="kxw6"><ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Tag</span><span class="pun">(</span><span class="pln">base</span><span class="pun">.</span><span class="typ">Base</span><span class="pun">):</span></code></li><li class="L1"><code class="language-python"><span class="pln">    __tablename__ </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Tag"</span></code></li><li class="L2"><code class="language-python"><span class="pln">    id </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> primary_key </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span></code></li><li class="L3"><code class="language-python"><span class="pln">    description </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">String</span><span class="pun">(</span><span class="lit">50</span><span class="pun">))</span></code></li><li class="L4"><code class="language-python"><span class="pln">    picture </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">String</span><span class="pun">(</span><span class="lit">50</span><span class="pun">))</span></code></li></ol></pre><p data-anchor-id="iujw">food菜</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="vgh6"><ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Food</span><span class="pun">(</span><span class="pln">base</span><span class="pun">.</span><span class="typ">Base</span><span class="pun">):</span></code></li><li class="L1"><code class="language-python"><span class="pln">    __tablename__ </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Food"</span></code></li><li class="L2"><code class="language-python"><span class="pln">    id </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> primary_key </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span></code></li><li class="L3"><code class="language-python"><span class="pln">    name </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">String</span><span class="pun">(</span><span class="lit">50</span><span class="pun">),</span><span class="pln"> unique </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">,</span><span class="pln"> nullable </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">False</span><span class="pun">)</span></code></li><li class="L4"><code class="language-python"><span class="pln">    picture </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">String</span><span class="pun">(</span><span class="lit">50</span><span class="pun">))</span></code></li><li class="L5"><code class="language-python"><span class="pln">    price </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> nullable </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">False</span><span class="pun">)</span></code></li><li class="L6"><code class="language-python"><span class="pln">    description </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">String</span><span class="pun">(</span><span class="lit">50</span><span class="pun">))</span></code></li><li class="L7"><code class="language-python"><span class="pln">    rating </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">)</span></code></li><li class="L8"><code class="language-python"><span class="pln">    amount </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> nullable </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">False</span><span class="pun">)</span></code></li><li class="L9"><code class="language-python"><span class="pln">    tag_id </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="str">'Tag.id'</span><span class="pun">),</span><span class="pln"> nullable </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">False</span><span class="pun">)</span></code></li></ol></pre><p data-anchor-id="uyak">comment评论</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="zljf"><ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Comment</span><span class="pun">(</span><span class="pln">base</span><span class="pun">.</span><span class="typ">Base</span><span class="pun">):</span></code></li><li class="L1"><code class="language-python"><span class="pln">    __tablename__ </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Comment"</span></code></li><li class="L2"><code class="language-python"><span class="pln">    comment_id </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> primary_key </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span></code></li><li class="L3"><code class="language-python"><span class="pln">    content </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">String</span><span class="pun">(</span><span class="lit">50</span><span class="pun">),</span><span class="pln"> nullable </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">False</span><span class="pun">)</span></code></li><li class="L4"><code class="language-python"><span class="pln">    food_id </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> </span><span class="typ">ForeignKey</span><span class="pun">(</span><span class="str">'Food.id'</span><span class="pun">))</span></code></li></ol></pre><p data-anchor-id="6nt4">reservation订单</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="4p9n"><ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">class</span><span class="pln"> </span><span class="typ">Reservation</span><span class="pun">(</span><span class="pln">base</span><span class="pun">.</span><span class="typ">Base</span><span class="pun">):</span></code></li><li class="L1"><code class="language-python"><span class="pln">    __tablename__ </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Reservation"</span></code></li><li class="L2"><code class="language-python"><span class="pln">    reserve_id </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> primary_key </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">True</span><span class="pun">)</span></code></li><li class="L3"><code class="language-python"><span class="pln">    reserve_datetime </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">DateTime</span><span class="pun">,</span><span class="pln"> default </span><span class="pun">=</span><span class="pln"> datetime</span><span class="pun">.</span><span class="pln">datetime</span><span class="pun">.</span><span class="pln">now</span><span class="pun">())</span></code></li><li class="L4"><code class="language-python"><span class="pln">    pay_datetime </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">DateTime</span><span class="pun">,</span><span class="pln"> default </span><span class="pun">=</span><span class="pln"> datetime</span><span class="pun">.</span><span class="pln">datetime</span><span class="pun">.</span><span class="pln">now</span><span class="pun">())</span></code></li><li class="L5"><code class="language-python"><span class="pln">    table_num </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="typ">Integer</span><span class="pun">,</span><span class="pln"> nullable </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">False</span><span class="pun">)</span></code></li><li class="L6"><code class="language-python"><span class="pln">    food_list </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Column</span><span class="pun">(</span><span class="pln">JSON</span><span class="pun">)</span></code></li></ol></pre></div>
</body>
</html>