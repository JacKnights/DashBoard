(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{145:function(t,e,a){"use strict";a.r(e);var n=a(0),s=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"restful-api-的设计规范"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#restful-api-的设计规范","aria-hidden":"true"}},[t._v("#")]),t._v(" Restful API 的设计规范")]),a("h2",{attrs:{id:"uri"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#uri","aria-hidden":"true"}},[t._v("#")]),t._v(" URI")]),a("ol",[a("li",[t._v("不用大写；")]),a("li",[t._v("用中杠-不用下杠_；")]),a("li",[t._v("参数列表要encode；")]),a("li",[t._v("URI中的名词表示资源集合，使用复数形式。")]),a("li",[t._v("避免层级过深的URI。过深的导航容易导致url膨胀，不易维护。")]),a("li",[t._v("服务器端的组合实体必须在uri中通过父实体的id导航访问。")])]),a("h2",{attrs:{id:"request"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#request","aria-hidden":"true"}},[t._v("#")]),t._v(" Request")]),a("ul",[a("li",[t._v("GET (SELECT)：从服务器检索特定资源，或资源列表。")]),a("li",[t._v("POST (CREATE)：在服务器上创建一个新的资源。")]),a("li",[t._v("PUT (UPDATE)：更新服务器上的资源，提供整个资源。")]),a("li",[t._v("DELETE (DELETE)：从服务器删除资源。")])]),a("h2",{attrs:{id:"安全性和幂等性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全性和幂等性","aria-hidden":"true"}},[t._v("#")]),t._v(" 安全性和幂等性")]),a("ul",[a("li",[a("strong",[t._v("安全性")]),t._v(" ：不会改变资源状态，可以理解为只读的")]),a("li",[a("strong",[t._v("幂等性")]),t._v(" ：执行1次和执行N次，对资源状态改变的效果是等价的")])]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("方法")]),a("th",{staticStyle:{"text-align":"center"}},[t._v("安全性")]),a("th",{staticStyle:{"text-align":"center"}},[t._v("幂等性")])])]),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("GET")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("√")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("√")])]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("POST")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("×")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("×")])]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("PUT")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("×")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("√")])]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("DELETE")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("×")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("√")])])])]),a("p",[t._v("安全性和幂等性均不保证反复请求能拿到相同的response。以 DELETE 为例，第一次DELETE返回200表示删除成功，第二次返回404提示资源不存在，这是允许的。")]),a("h2",{attrs:{id:"复杂查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#复杂查询","aria-hidden":"true"}},[t._v("#")]),t._v(" 复杂查询")]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("参数形式")]),a("th",{staticStyle:{"text-align":"center"}},[t._v("示例")]),a("th",{staticStyle:{"text-align":"center"}},[t._v("备注")])])]),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("过滤条件")]),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("?type=1&age=16")])]),a("td",{staticStyle:{"text-align":"center"}},[t._v("允许一定的uri冗余，如/zoos/1与/zoos?id=1")])]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("排序")]),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("?sort=age,desc")])]),a("td",{staticStyle:{"text-align":"center"}})]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("投影")]),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("?whitelist=id,name,email")])]),a("td",{staticStyle:{"text-align":"center"}})]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("分页")]),a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("?limit=10&offset=3")])]),a("td",{staticStyle:{"text-align":"center"}})])])]),a("h2",{attrs:{id:"format"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#format","aria-hidden":"true"}},[t._v("#")]),t._v(" Format")]),a("ul",[a("li",[a("p",[t._v("Content-Type: application/json")]),a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[t._v("  "),a("span",{attrs:{class:"token constant"}},[t._v("POST")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("v1"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("animal "),a("span",{attrs:{class:"token constant"}},[t._v("HTTP")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token number"}},[t._v("1.1")]),t._v("\n  Host"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" api"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("example"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("org\n  Accept"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" application"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("json\n  Content"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Type"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" application"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("json\n  Content"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Length"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("24")]),t._v("\n\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   \n  \t"),a("span",{attrs:{class:"token string"}},[t._v('"name"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"Gir"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  \t"),a("span",{attrs:{class:"token string"}},[t._v('"animalType"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"12"')]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("li",[a("p",[t._v("Content-Type: application/x-www-form-urlencoded (浏览器POST表单用的格式)")]),a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{attrs:{class:"token constant"}},[t._v("POST")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("login "),a("span",{attrs:{class:"token constant"}},[t._v("HTTP")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token number"}},[t._v("1.1")]),t._v("\nHost"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" example"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\nContent"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Length"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("31")]),t._v("\nAccept"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" text"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("html\nContent"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("Type"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" application"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("x"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("www"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("form"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("urlencoded\n\nusername"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("root"),a("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("password"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("Zion0101\n")])])]),a("li",[a("p",[t._v("Content-Type: multipart/form-data; boundary=—-RANDOM_jDMUxq4Ot5 (表单有文件上传时的格式)")])])]),a("h2",{attrs:{id:"response"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#response","aria-hidden":"true"}},[t._v("#")]),t._v(" Response")]),a("ol",[a("li",[a("p",[t._v("不要包装：response 的 body 直接就是数据，不要做多余的包装。")])]),a("li",[a("p",[t._v("各HTTP方法成功处理后的数据格式：")]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("方法")]),a("th",{staticStyle:{"text-align":"center"}},[t._v("response 格式")])])]),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("GET")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("单个对象、集合")])]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("POST")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("新增成功的对象")])]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("PUT")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("更新成功的对象")])]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("DELETE")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("空")])])])])]),a("li",[a("p",[t._v("json格式的约定：")]),a("ol",[a("li",[t._v("时间用长整形(毫秒数)，客户端自己按需解析（moment.js）")]),a("li",[t._v("不传null字段")])])])]),a("h2",{attrs:{id:"错误处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误处理","aria-hidden":"true"}},[t._v("#")]),t._v(" 错误处理")]),a("ol",[a("li",[t._v("不要发生了错误但给2xx响应，客户端可能会缓存成功的http请求；")]),a("li",[t._v("正确设置http状态码，不要自定义；")]),a("li",[t._v("Response body 提供 1) 错误的代码（日志/问题追查）；2) 错误的描述文本（展示给用户）。")])]),a("p",[t._v("业务类异常必须提供2种信息：")]),a("ol",[a("li",[t._v("如果抛出该类异常，HTTP 响应状态码应该设成什么；")]),a("li",[t._v("异常的文本描述；")])]),a("p",[t._v("在Controller层使用统一的异常拦截器：")]),a("ol",[a("li",[t._v("设置 HTTP 响应状态码：对业务类异常，用它指定的 HTTP code；对非业务类异常，统一500；")]),a("li",[t._v("Response Body 的错误码：异常类名")]),a("li",[t._v("Response Body 的错误描述：对业务类异常，用它指定的错误文本；对非业务类异常，线上可以统一文案如“服务器端错误，请稍后再试”，开发或测试环境中用异常的 stacktrace，服务器端提供该行为的开关")])]),a("p",[t._v("常用的http状态码及使用场景：")]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("状态码")]),a("th",{staticStyle:{"text-align":"center"}},[t._v("使用场景")])])]),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("400 bad request")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("常用在参数校验")])]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("401 unauthorized")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("未经验证的用户，常见于未登录。如果经过验证后依然没权限，应该 403（即 authentication 和 authorization 的区别）。")])]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("403 forbidden")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("无权限")])]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("404 not found")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("资源不存在")])]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("500 internal server error")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("非业务类异常")])]),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("503 service unavaliable")]),a("td",{staticStyle:{"text-align":"center"}},[t._v("由容器抛出，自己的代码不要抛这个异常")])])])]),a("h2",{attrs:{id:"参考文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文档","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考文档")]),a("ol",[a("li",[a("a",{attrs:{href:"http://novoland.github.io/%E8%AE%BE%E8%AE%A1/2015/08/17/Restful%20API%20%E7%9A%84%E8%AE%BE%E8%AE%A1%E8%A7%84%E8%8C%83.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Restful API 的设计规范")])]),a("li",[a("a",{attrs:{href:"https://www.jianshu.com/p/8b769356ee67",target:"_blank",rel:"noopener noreferrer"}},[t._v("restful接口设计规范总结")])])])])}],!1,null,null,null);e.default=s.exports}}]);